<script>

class EventsModel {

  constructor() {
    this.server = new Server()
  }

  async addEvent(event) {
    const newEvent = await this.server.apiCall('insertEvent', event)
      app.events.push(newEvent)
  }

  async exportYearlyEvents(year) {
    await this.server.apiCall('exportYearlyEvents', year)
  }

  getEvent(id) {
    const index = app.getArrayIndex(app.events, id)
    const event = app.events[index]

    return event
  }

  setEventStatus(id) {

    const index = app.getArrayIndex(app.events, id)
    const event = app.events[index]

    // if change is allowed
    if (event.cleared === '') {
      const status = (event.charging === 'x') ? '' : 'x'
      // change locally
      app.events[index].charging = status
      // change on server
      this.server.apiCall('setChargingStatus', id, status)
    }
  }

  setCurrentYear(year) {
    app.currentYear = year
  }
  
  async updateEvent(event) {
    const index = app.getArrayIndex(app.events, event.id)
    app.events[index] = event

    await this.server.apiCall('updateEvent', event)
  }

}
</script>