<script>

class EventsModel {

  static async addEvent(event) {
    const newEvent = await Server.apiCall('insertEvent', event)
      Db.insertRecord('events', newEvent)
  }

  static async exportYearlyEvents(year) {
    await Server.apiCall('exportYearlyEvents', year)
  }

  static getEvent(id) {
    return Db.getRecord('events', id)
  }

  static getEvents(year) {
    const events = Db.getRecords('events')
    
    const eventsPerYear = events.filter( event => {
       if (event.date.substring(0, 4) == year) {   // String compared with Number
         return event
       }
     })
    
    return eventsPerYear
  }

  static getNewEvent() {
    const event = Db.getNewRecord('events')
    event.id          = 0
    event.total       = 0
    event.a_share     = 0
    event.account_id  = 1
    event.fiscal_year = Db.currentYear

    return event
  }

  static setEventStatus(id) {
    const event = Db.getRecord('events', id)
    // if change is allowed
    if (event.cleared === '') {
      const status = (event.charging === 'x') ? '' : 'x'
      // change locally
      event.charging = status
      Db.updateRecord('events', event)
      // change on server
      Server.apiCall('setChargingStatus', id, status)
    }
  }
  
  static async updateEvent(event) {
    // Update local Db
    Db.updateRecord('events', event)
    // Update server Db
    await Server.apiCall('updateEvent', event)
  }
}
</script>