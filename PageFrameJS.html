<script>

/* GLOBAL VARIABLES AND FUNCTIONS*/

  const app = {}

  const spinner = {
    on: () => {$('.spinner').show()},
    off: () => {$('.spinner').hide()}
  }

  const popup = {
    on: () => {$('.popup').show()},
    off: () => {$('.popup').hide()}
  }

  function getTableIndex(table, id) {

    return table.findIndex( (rec) => {
      return rec.id === id
    })
  }

/* KICK START */

  $('document').ready (() => {

    spinner.on()

    frontPage.render()

    /* Event Listeners */
    $('#page0').on('click',frontPage.render)
    $('#page1').on('click',eventsPage.render)
    $('#page2').on('click',readingsPage.render)
    $('#page3').on('click',reportsPage.render)
    $('#page4').on('click',chargingPage.render)

    $('.nav-item').on('click',changeNavSelection)

    /* Data request */
    google.script.run
    .withFailureHandler((error)=>{alert(error)})
    .withSuccessHandler(storeData)
    .apiCall('getData')

  })

  /* CALLBACK FUNCTIONS */
  function storeData(response) {

    app.events = response[0]
    app.water = response[1]
    app.years = response[2]
    app.accounts = response[3]
    app.currentYear = response[4]

    spinner.off()
  }

  /* EVENT HANDLER */

  function changeNavSelection () {

    $('.nav-item').css('background', '')
    $('.nav-item').css('font-weight', '')
    $(this).css('background', '#333385')
    $(this).css('font-weight', 'bold')
  }
</script>