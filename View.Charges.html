<script>

View.Charges = (function () {
  const public = {}

  public.render = (controller, eventsToBeCharged) => {
    renderControls()
    renderContent(eventsToBeCharged)
    setEventListeners(controller)
  }
  
  function renderControls() {

    frame.controls.html(`
      <input id="txt-day" type="date" hidden>
      <button class="btn" id="btn-submit" hidden> Kuittaa maksetuksi </button>
      <button class="btn" id="btn-print" hidden> Tulosta </button>`
    )
  }

  function renderContent(eventsToBeCharged) {

    let content = `
      <table id="tbl-charges">
        <tr>
          <th>Päiväys</th>
          <th>Tapahtuma</th>
          <th>Koko summa</th>
          <th>A-asunto</th>
          <th>Tili</th>
        </tr>`

    let a_Total = 0

    eventsToBeCharged.forEach( (event) => {
      a_Total += event.a_share
      content += `
        <tr>
          <td>${event.date}</td>
          <td>${event.event}</td>
          <td class="number">${event.total.toFixed(2)}</td>
          <td class="number">${event.a_share.toFixed(2)}</td>
          <td>${event.account_name}</td>
        </tr>`
    })

    content += `
        <tr>
          <td class="empty"></td>
          <td class="empty"></td>
          <td class="total">Yhteensä</td>
          <td class="total">${a_Total.toFixed(2)}</td>
          <td class="empty"></td>
        </tr>
      </table>`

    frame.content.html(content)
  }

  function setEventListeners(ctrl) {

    if (app.params.profile === 'admin') {
      $('#txt-day').show()
      $('#btn-submit').show()
      $('#btn-print').show()
    }

    $('#btn-submit').on('click', () => {
      const date = $('#txt-day').val()
      if ( date === '') {
        alert('Tarkista päiväys')
        return
      }
      ctrl.onAckCharges(date)
    })

    $('#btn-print').on('click', () => {
      ctrl.onPrintChargingSheet()
    })
  }

  return public
})()
</script>