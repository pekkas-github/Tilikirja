<script>

class EventsController {

  static addNewEvent() {
    const event    = EventsModel.getNewEvent()
    const accounts = Common.getAccounts()
    const years    = Common.getYears()

    EventFormView.controller = this
    EventFormView.event      = event
    EventFormView.render(accounts, years)
  }
     
  static toggleEventStatus(id) {
    EventsModel.toggleEventStatus(id)
    this.openEventsPage()
  }


  static setCurrentYear(year) {
    Common.setCurrentYear(year)
    this.openEventsPage()
  }
    
  static modifyEvent(id) {
    const event    = EventsModel.getEvent(id)
    const accounts = Common.getAccounts()
    const years    = Common.getYears()

    EventFormView.controller = this
    EventFormView.event      = event
    EventFormView.render(accounts, years)
  }

  static openEventComment(id) {
    const event = EventsModel.getEvent(id)
    if (event.comment != '') {
      EventCommentView.render(event)
    }
  }

  static openEventsPage() {
    const years       = Common.getYears()
    const currentYear = Common.getCurrentYear()
    const events      = EventsModel.getEventsOfYear(currentYear)

    EventsView.controller = this
    EventsView.render(events, years, currentYear)
  }


  static async exportYearlyEvents(year) {
    await Common.exportYearlyEvents(year)
    alert(`Vuoden ${year} tapahtumat talletettu taulukkoon.`)
  }

  static async saveEvent(event) {
    if (event.id === 0) {
      //insert
      EventsModel.addEvent(event)
      this.openEventsPage()
    } else {
      //update
      EventsModel.updateEvent(event)
      this.openEventsPage()
    }
  }
}

</script>