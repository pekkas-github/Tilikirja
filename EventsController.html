<script>

class EventsController {

  static openPage() {
    const years       = Common.getYears()
    const currentYear = Common.getCurrentYear()
    const events      = EventsModel.getEventsOfYear(currentYear)

    EventsView.render(this, events, years, currentYear)
  }

  static onAddNewEvent() {
    const event    = EventsModel.getNewEvent()
    const accounts = Common.getAccounts()
    const years    = Common.getYears()

    EventFormView.event      = event
    EventFormView.render(this, accounts, years)
  }
     
  static onChangeYear(year) {
    Common.setCurrentYear(year)
    this.openPage()
  }
    
  static async onExportEventsOnSheet(year) {
    await Common.exportYearlyEvents(year)
    alert(`Vuoden ${year} tapahtumat talletettu taulukkoon.`)
  }

  static onModifyEvent(id) {
    const event    = EventsModel.getEvent(id)
    const accounts = Common.getAccounts()
    const years    = Common.getYears()

    EventFormView.event      = event
    EventFormView.render(this, accounts, years)
  }

  static onOpenComment(id) {
    const event = EventsModel.getEvent(id)
    if (event.comment != '') {
      EventCommentView.render(event)
    }
  }

  static async onSaveEvent(event) {
    if (event.id === 0) {
      //insert
      EventsModel.addEvent(event).then(() => {
        this.openPage()
      })
      this.openPage()
    } else {
      //update
      EventsModel.updateEvent(event)
      this.openPage()
    }
  }

  static onToggleEventStatus(id) {
    EventsModel.toggleEventStatus(id)
    this.openPage()
  }
}

</script>