<script>

class EventsController {

  static addNewEvent() {
    const event = EventsModel.getNewEvent()
    const accounts = Events.getAccounts()
    const years    = EventsModel.getYears()

    EventFormView.controller = this
    EventFormView.event      = event
    EventFormView.render(accounts, years)
  }
     
  static setEventStatus(id) {
    EventsModel.setEventStatus(id)
    this.openEventsPage()
  }


  static setCurrentYear(year) {
    EventsModel.setCurrentYear(year)
    this.openEventsPage()
  }
    
  static modifyEvent(id) {
    const event    = EventsModel.getEvent(id)
    const accounts = EventsModel.getAccounts()
    const years    = EventsModel.getYears()

    EventFormView.controller = this
    EventFormView.event      = event
    EventFormView.render(accounts, years)
  }

  static openEventComment(id) {
    const event = EventsModel.getEvent(id)
    if (event.comment != '') {
      EventCommentView.render(event)
    }
  }

  static openEventsPage() {
    const years       = EventsModel.getYears()
    const currentYear = EventsModel.getCurrentYear()
    const events      = EventsModel.getEvents(currentYear)

    EventsView.controller = this
    EventsView.render(events, years, currentYear)
  }


  static async exportYearlyEvents(year) {
    await EventsModel.exportYearlyEvents(year)
    alert(`Vuoden ${year} tapahtumat talletettu taulukkoon.`)
  }

  static async saveEvent(event) {
    if (event.id === 0) {
      //insert
      app.spinner.on()
      await EventsModel.addEvent(event)
        this.openEventsPage()
        app.spinner.off()
        app.popup.off()
    } else {
      //update
      EventsModel.updateEvent(event)
      this.openEventsPage()
      app.popup.off()
    }
  }
}

</script>