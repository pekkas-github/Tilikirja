<script>

class EventsController {

  static model = new EventsModel()

  static addNewEvent() {
    const event = this.model.getNewEvent()
    const accounts = this.model.getAccounts()
    const years    = this.model.getYears()

    EventFormView.controller = this
    EventFormView.event      = event
    EventFormView.render(accounts, years)
  }
     
  static setEventStatus(id) {
    this.model.setEventStatus(id)
    this.openEventsPage()
  }


  static setCurrentYear(year) {
    this.model.setCurrentYear(year)
    this.openEventsPage()
  }
    
  static modifyEvent(id) {
    const event    = this.model.getEvent(id)
    const accounts = this.model.getAccounts()
    const years    = this.model.getYears()

    EventFormView.controller = this
    EventFormView.event      = event
    EventFormView.render(accounts, years)
  }

  static openEventComment(id) {
    const event = this.model.getEvent(id)
    if (event.comment != '') {
      EventCommentView.render(event)
    }
  }

  static openEventsPage() {
    const years       = this.model.getYears()
    const currentYear = this.model.getCurrentYear()
    const events      = this.model.getEvents(currentYear)

    EventsView.controller = this
    EventsView.render(events, years, currentYear)
  }


  static async exportYearlyEvents(year) {
    await this.model.exportYearlyEvents(year)
    alert(`Vuoden ${year} tapahtumat talletettu taulukkoon.`)
  }

  static async saveEvent(event) {
    if (event.id === 0) {
      //insert
      app.spinner.on()
      await this.model.addEvent(event)
        this.openEventsPage()
        app.spinner.off()
        app.popup.off()
    } else {
      //update
      this.model.updateEvent(event)
      this.openEventsPage()
      app.popup.off()
    }
  }
}

</script>