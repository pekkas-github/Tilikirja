<script>

class ChargesModel {

  constructor() {
    this.server = new Server()
  }

  ackCharges(date) {
    return new Promise((resolve, reject) => {

      const eventsToBeCharged = this.getEventsToBeCharged()
      eventsToBeCharged.forEach( (event) => {
        const tableIndex = app.getArrayIndex(app.events, event.id)
        app.events[tableIndex].cleared = date
      })

      this.server.apiCall('ackCharges', eventsToBeCharged, date)
      .then(resolve)
      .catch(err => reject(err))
    })
  }

  getEventsToBeCharged() {
    return app.events.filter( (event) => {
      if (event.charging === 'x' && event.cleared === '') {
        return event
      }
    })
  }
}

</script>