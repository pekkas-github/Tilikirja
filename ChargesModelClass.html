<script>

class ChargesModel {

  constructor() {
    this.server = new Server()
  }

  ackCharges(date) {
    // Local update
    const events = this.getEventsToBeCharged()

    for (const event of events) {
      event.cleared = date
      Db.updateRecord('events', event)
    }


    this.server.apiCall('ackCharges', events, date)
  }

  getEventsToBeCharged() {
    const events = Db.getRecords('events').where('cleared', '').where('charging', 'x')
    return events.slice(0, events.length)  // Drop function defs from the array
  }
}

</script>