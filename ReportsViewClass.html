<script>

class ReportsView {

  constructor(controller) {
    this.controller = controller
  }

  render(summaryByAccount, accounts, years, currentYear) {
    this.renderControls(years, currentYear)
    this.setControlsEventListeners()
    this.renderContent(summaryByAccount, accounts)
  }

  renderControls(years, currentYear) {

    let options = ''
    for(const year of years) {
      const selected = (year.year === currentYear) ? 'selected' : ''
      options += `
        <option ${selected}>
          ${year.year}
        </option>
      `
    }
    const controls = `
      <select class="cbo" id="cbo-years" name="years">
        ${options}
      </select>  
    `
    $('.controls').html(controls)
  }

  setControlsEventListeners() {
    
    const self = this
    $('#cbo-years').on('change', () => {
      self.controller.changeYear(parseInt($('#cbo-years').val()))})
  }

  renderContent(summaryByAccount, accounts) {
    
    let content = `
      <table id="tbl-reports">
      <tr>
        <th>Tili</th>
        <th>Summa</th>
        <th>A-osuus</th>
        <th>B-osuus</th>
      </tr>`

    accounts.forEach( (account) => {
      if (summaryByAccount[account.id]) {
      content += `
      <tr id="${account.id}">
        <td>${account.name}</td>
        <td class="number"> ${summaryByAccount[account.id].tot.toFixed(2)}</td>
        <td class="number"> ${summaryByAccount[account.id].a.toFixed(2)}</td>
        <td class="number"> ${summaryByAccount[account.id].b.toFixed(2)}</td>
      </tr>`
      }
    })

    content += `
    <tr>
      <th class="total"> Yhteens√§ </th>
      <th class="total"> ${summaryByAccount.Totals.tot.toFixed(2) } </th>
      <th class="total"> ${ summaryByAccount.Totals.a.toFixed(2) } </th>
      <th class="total"> ${ summaryByAccount.Totals.b.toFixed(2) } </th>
    </tr>
    </table>`
    $('.content').html(content)

  }
}
</script>