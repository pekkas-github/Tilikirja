<script>

class EventsView { 

  constructor(controller) {
    this.controller = controller
  }

  render() {
    
    /* CONTROLS */

    let controls = '<select id="cbo-years" name="years" class="cbo">'

    app.years.forEach( (year) => {
      controls += `<option>${year.year}</option>`
    })

    controls += '</select>'

    controls += '<button class="btn" id="btn-add" hidden>Lis채채...</button>'

    $('.controls').html(controls)
    $('#cbo-years').val(app.currentYear)

    /* CONTENT */

    let content = `
    <table id="tbl-events">
      <tr>
        <th>Tosite</th>
        <th>P채iv채ys</th>
        <th>Tapahtuma</th>
        <th>Summa</th>
        <th>A-asunto</th>
        <th>Tili</th>
        <th>Kommentti</th>
        <th>Tilivuosi</th>
        <th class="charge-status" hidden>Veloitus</th>
        <th class="is-payed" hidden>Ok</th>
      </tr>
    `
    app.events.forEach( (event) => {
      if (event.date.substring(0, 4) === app.currentYear) {
        content += `
        <tr id="${event.id}">
          <td> ${event.number}</td>
          <td> ${event.date}</td>
          <td> ${event.event}</td>
          <td class="number"> ${event.total.toFixed(2)}</td>
          <td class="number"> ${event.a_share.toFixed(2)}</td>
          <td> ${event.account_name}</td>
          <td> ${event.comment}</td>
          <td> ${event.fiscal_year}</td>
          <td class="charge-status" hidden>${event.charging}</td>
          <td class="is-payed" hidden>${event.cleared}</td>
        </tr>`
      }
    })
    
    content += '</table>'
    
    $('.content').html(content)

    /* EVENT LISTENERS */

    const that = this

    $('#cbo-years').on('change', function() {
        that.controller.setCurrentYear($('#cbo-years').val())
      })

    if (profile === 'admin') {
      $('td').on('dblclick', function() {
        that.controller.modifyEvent(parseInt($(this).parent().attr('id')))})

      $('#btn-add').show()
      $('#btn-add').on('click', function() {
        that.controller.addNewEvent()})

      $('.charge-status').show()
      $('.charge-status').on('click', function() {
        that.controller.setEventStatus(parseInt($(this).parent().attr('id')))})

      $('.is-payed').show()
    }
  }
  
}

</script>