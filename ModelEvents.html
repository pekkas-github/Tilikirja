<script>

const eventsModel = (function() {

  function addEvent(event, callback) {
    google.script.run
      .withSuccessHandler((newEvent) => {
        app.events.push(newEvent)
        callback()
      })
      .apiCall('insertEvent', event)
  }

  function changeEventStatus(id) {
    const index = getTableIndex(app.events, id)
    const event = app.events[index]

    //selvitä, onko muutos sallittu
    if (event.cleared === '') {

      //aseta status -> päälle/pois
      const status = (event.charging === 'x') ? '' : 'x'
      app.events[index].charging = status

      //lähetä tieto serverille
      google.script.run
      .apiCall('setChargingStatus', id, status)
    }

  }

  function changeCurrentYear(year) {
    app.currentYear = year
  }

  function getEvent(id) {
    const index = getTableIndex(app.events, id)
    const record = app.events[index]

    return {record: record, index: index}
  }

  function updateEvent(event, index) {
    app.events[index] = event
    google.script.run
      .apiCall('updateEvent', event)
  }

return {
  addEvent: addEvent,
  changeEventStatus: changeEventStatus,
  changeCurrentYear: changeCurrentYear,
  getEvent: getEvent,
  updateEvent: updateEvent
}
})()

</script>