<script>
  
class ReadingsModel {

  constructor() {
    //this.server = new Server()
  }

  async addReading(reading) {
    const result = await Server.apiCall('insertReading', reading)
      Db.insertRecord('water', result.newReading)
      Db.insertRecord('events', result.newEvent)
  }

  getCurrentWaterPrice() {
    return Db.currentWaterPrice
  }

  getReadings(count) {
    const readings = Db.getRecords('water')
    const len      = readings.length
    const deltas   = []

    for (let i = len - count; i < len; i++) {
      const actual   = {...readings[i]} // Clone reading object
      const previous = readings[i-1]

      const tot        = actual.master_reading - previous.master_reading
      actual.totDelta  = (tot < 0) ? actual.master_reading : tot
      actual.aDelta    = actual.a_reading - previous.a_reading
      actual.bDelta    = actual.b_reading - previous.b_reading 
      deltas.push(actual)
    }
    return deltas
  }
}
</script>