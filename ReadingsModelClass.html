<script>
  
class ReadingsModel {

  constructor() {
    this.server = new Server()
  }

  async addReading(reading) {
    app.water.push(reading)

    const result = await this.server.apiCall('insertReading', reading)
    for (const reading of app.water) {
      if (reading.id === result.newId) {
        reading.id = result.newId     // Update new reading id in local table
      }
    }
    app.events.push(result.newEvent)  // Add created event in local table
  }

  getReadings(nbr) {
    const len    = app.water.length
    const deltas = []

    for (let i = len - nbr; i < len; i++) {
      const actual   = {...app.water[i]} // Clone reading object
      const previous = app.water[i-1]

      const tot        = actual.master_reading - previous.master_reading
      actual.totDelta  = (tot < 0) ? actual.master_reading : tot
      actual.aDelta    = actual.a_reading - previous.a_reading
      actual.bDelta    = actual.b_reading - previous.b_reading 
      deltas.push(actual)
    }
    return deltas
  }
}
</script>