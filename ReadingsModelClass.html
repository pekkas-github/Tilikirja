<script>
  
class ReadingsModel {

  constructor() {
    this.server = new Server()
  }

  addReading(reading) {
    return new Promise((resolve, reject) => {

      app.water.push(reading)

      this.server.apiCall('insertReading', reading) //Save reading and create event
      .then(result => {
        app.water.forEach( reading => {
          if(reading.id === 0) {
            reading.id = result.newId  //Update new reading id in local table
          }
        })
        app.events.push(result.newEvent) //Add created event in local table
        resolve()
      })
      .catch(err => {
        reject(err)
      })
    })
  }

  getReadings() {
    return new Promise((resolve, reject) => {
      
      this.server.apiCall('getWaterReadings')
      .then(readings => {
        app.water = readings
        resolve(readings)
      })
      .catch(err => {
        reject(err)
      })

    })
  }
}
</script>